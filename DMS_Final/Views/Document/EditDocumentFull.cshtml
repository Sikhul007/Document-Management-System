@model List<DMS_Final.Models.DocumentDetailsModel>
@using DMS_Final.Models
@{
    var document = ViewBag.Document as DocumentModel;
    var allTags = ViewBag.AllTags as List<TagModel>;
}

<h2>Edit Document</h2>
<form asp-action="SaveDocumentEdits" asp-controller="Document" method="post" enctype="multipart/form-data">
    <input type="hidden" name="DocumentId" value="@document?.Id" />

    <div class="mb-3">
        <label>Title</label>
        <input type="text" name="Title" value="@document?.Title" class="form-control" required />
    </div>
    <div class="mb-3">
        <label>Description</label>
        <textarea name="Description" class="form-control" required>@document?.Description</textarea>
    </div>

    <hr />
    <h4>Files</h4>
    @for (int i = 0; i < Model.Count; i++)
    {
        var file = Model[i];
        <div class="border p-2 mb-3">
            <input type="hidden" name="FileIds" value="@file.Id" />
            <div class="mb-2 d-flex justify-content-between align-items-center">
                <div>
                    <label>
                        <span style="display:inline-block; max-width:780px; word-break:break-all; white-space:normal;">
                           File Name:  <b>@file.OriginalFileName</b>
                        </span>
                    </label>
                    
                </div>
                <div>
                    <a asp-action="ViewDocument" asp-route-documentDetailId="@file.Id" class="btn btn-info btn-sm" target="_blank" title="View Document">
                        <i class="bi bi-eye"></i>
                    </a>
                    <a asp-action="DownloadDocument" asp-route-documentDetailId="@file.Id" class="btn btn-success btn-sm" title="Download Document">
                        <i class="bi bi-cloud-arrow-down-fill"></i>
                    </a>
                </div>
            </div>
            <div class="mb-2">
                <label>Description</label>
                <input type="text" name="FileDescriptions" value="@file.Description" class="form-control" />
            </div>
            <div class="mb-2">
                <label>Tags</label>
                <select name="TagIds[@i]" class="form-control tag-select" multiple="multiple" style="width: 100%;">
                    @foreach (var tag in allTags)
                    {
                        if (file.Tags.Contains(tag.Name))
                        {
                            <option value="@tag.Id" selected>@tag.Name</option>
                        }
                        else
                        {
                            <option value="@tag.Id">@tag.Name</option>
                        }
                    }
                </select>
            </div>
            <div class="mb-2">
                <label>Upload New Version(s)</label>
                <input type="file" name="NewFiles[@i]" multiple class="form-control" />
            </div>
            @* <div class="mb-2">
                <label>Version</label>
                <span>@file.VersionNumber</span>
            </div> *@
        </div>
    }
    <button type="submit" class="btn btn-success">Save Changes</button>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script>
        $(document).ready(function () {
            $('.tag-select').select2({
                placeholder: "Select tags",
                allowClear: true
            });
        });
    </script>
}